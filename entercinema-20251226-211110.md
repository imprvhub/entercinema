# Database Analysis: entercinema

**Generated:** 26/12/2025, 09:11:10

## Statistics

- **Total Tables:** 13
- **Total Rows:** 3536
- **Total Indexes:** 23
- **Total Triggers:** 3

---

## Tables

### archived_conversations

**Row Count:** 3

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| chat_id | TEXT | ✗ | - | ✓ |
| user_email | TEXT | ✗ | - | ✗ |
| archived_at | INTEGER | ✗ | - | ✗ |

### auth_user

**Row Count:** 0

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| email | TEXT | ✓ | - | ✗ |
| first_name | TEXT | ✗ | - | ✗ |
| last_name | TEXT | ✗ | - | ✗ |
| date_joined | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| last_login | DATETIME | ✗ | - | ✗ |
| created_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| updated_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |

### chat_interactions

**Row Count:** 557

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| chat_id | TEXT | ✓ | - | ✗ |
| query | TEXT | ✓ | - | ✗ |
| response | TEXT | ✓ | - | ✗ |
| language | TEXT | ✓ | - | ✗ |
| media_references | TEXT | ✗ | - | ✗ |
| created_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| user_id | TEXT | ✗ | - | ✗ |
| user_email | TEXT | ✗ | - | ✗ |

### notification_history

**Row Count:** 759

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| person_id | INTEGER | ✓ | - | ✗ |
| media_id | INTEGER | ✓ | - | ✗ |
| media_type | TEXT | ✓ | - | ✗ |
| created_at | INTEGER | ✗ | unixepoch() | ✗ |

### notifications

**Row Count:** 744

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| person_id | INTEGER | ✓ | - | ✗ |
| person_name | TEXT | ✓ | - | ✗ |
| media_type | TEXT | ✓ | - | ✗ |
| media_id | INTEGER | ✓ | - | ✗ |
| media_title | TEXT | ✓ | - | ✗ |
| release_date | TEXT | ✓ | - | ✗ |
| notification_type | TEXT | ✓ | - | ✗ |
| created_at | INTEGER | ✗ | unixepoch() | ✗ |
| read | INTEGER | ✗ | 0 | ✗ |
| poster_path | TEXT | ✗ | - | ✗ |
| overview | TEXT | ✗ | - | ✗ |
| character | TEXT | ✗ | - | ✗ |
| profile_path | TEXT | ✗ | - | ✗ |
| series_poster_path | TEXT | ✗ | - | ✗ |
| secondary_profile_path | TEXT | ✗ | - | ✗ |

### requests

**Row Count:** 0

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| email | TEXT | ✓ | - | ✗ |
| action | TEXT | ✓ | - | ✗ |
| is_executed | TEXT | ✗ | 'false' | ✗ |
| created_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| updated_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |

### user_company_follows

**Row Count:** 37

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| company_id | INTEGER | ✓ | - | ✗ |
| company_name | TEXT | ✓ | - | ✗ |
| logo_path | TEXT | ✗ | - | ✗ |
| origin_country | TEXT | ✗ | - | ✗ |
| followed_at | INTEGER | ✗ | unixepoch() | ✗ |

### user_custom_list_items

**Row Count:** 3

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| list_id | INTEGER | ✓ | - | ✗ |
| item_id | INTEGER | ✓ | - | ✗ |
| item_type | TEXT | ✓ | - | ✗ |
| name | TEXT | ✗ | - | ✗ |
| poster_url | TEXT | ✗ | - | ✗ |
| year_start | INTEGER | ✗ | - | ✗ |
| year_end | INTEGER | ✗ | - | ✗ |
| genres | TEXT | ✗ | - | ✗ |
| tmdb_rating | REAL | ✗ | - | ✗ |
| imdb_rating | REAL | ✗ | - | ✗ |
| added_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |

#### Foreign Keys

| Column | References Table | References Column |
|--------|------------------|-------------------|
| list_id | user_custom_lists | id |

### user_custom_lists

**Row Count:** 6

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| name | TEXT | ✓ | - | ✗ |
| description | TEXT | ✗ | - | ✗ |
| slug | TEXT | ✗ | - | ✗ |
| is_public | INTEGER | ✗ | 0 | ✗ |
| created_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| updated_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |

### user_data

**Row Count:** 0

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| email | TEXT | ✓ | - | ✗ |
| first_name | TEXT | ✗ | - | ✗ |
| last_name | TEXT | ✗ | - | ✗ |
| avatar | TEXT | ✗ | '/avatars/avatar-ss0.png' | ✗ |
| created_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |
| updated_at | DATETIME | ✗ | CURRENT_TIMESTAMP | ✗ |

### user_follows

**Row Count:** 488

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| person_id | INTEGER | ✓ | - | ✗ |
| person_name | TEXT | ✓ | - | ✗ |
| person_type | TEXT | ✓ | - | ✗ |
| followed_at | INTEGER | ✗ | unixepoch() | ✗ |
| profile_path | TEXT | ✗ | - | ✗ |
| secondary_profile_path | TEXT | ✗ | - | ✗ |

### user_tv_follows

**Row Count:** 18

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | INTEGER | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| tv_id | INTEGER | ✓ | - | ✗ |
| tv_name | TEXT | ✓ | - | ✗ |
| poster_path | TEXT | ✗ | - | ✗ |
| overview | TEXT | ✗ | - | ✗ |
| vote_average | REAL | ✗ | - | ✗ |
| status | TEXT | ✗ | - | ✗ |
| followed_at | INTEGER | ✗ | unixepoch() | ✗ |

### user_watchlist_items

**Row Count:** 921

#### Columns

| Name | Type | Not Null | Default | Primary Key |
|------|------|----------|---------|-------------|
| id | TEXT | ✗ | - | ✓ |
| user_email | TEXT | ✓ | - | ✗ |
| item_id | INTEGER | ✓ | - | ✗ |
| item_type | TEXT | ✓ | - | ✗ |
| name | TEXT | ✓ | - | ✗ |
| poster_url | TEXT | ✗ | - | ✗ |
| year_start | INTEGER | ✗ | - | ✗ |
| year_end | INTEGER | ✗ | - | ✗ |
| genres | TEXT | ✗ | - | ✗ |
| tmdb_rating | REAL | ✗ | - | ✗ |
| imdb_rating | REAL | ✗ | - | ✗ |
| imdb_votes | INTEGER | ✗ | - | ✗ |
| rating_source | TEXT | ✗ | - | ✗ |
| user_rating | INTEGER | ✗ | - | ✗ |
| user_review | TEXT | ✗ | - | ✗ |
| external_ids | TEXT | ✗ | - | ✗ |
| added_at | TEXT | ✓ | datetime('now') | ✗ |
| updated_at | TEXT | ✓ | datetime('now') | ✗ |
| imdb_id | TEXT | ✗ | - | ✗ |
| runtime | INTEGER | ✗ | - | ✗ |

---

## Indexes

### idx_added_at

**Table:** user_watchlist_items

**Columns:** added_at

**SQL:**
```sql
CREATE INDEX idx_added_at ON user_watchlist_items(added_at)
```

### idx_auth_user_email

**Table:** auth_user

**Columns:** email

**SQL:**
```sql
CREATE INDEX idx_auth_user_email ON auth_user(email)
```

### idx_chat_interactions_chat_date

**Table:** chat_interactions

**Columns:** chat_id, created_at

**SQL:**
```sql
CREATE INDEX idx_chat_interactions_chat_date ON chat_interactions(chat_id, created_at)
```

### idx_chat_interactions_chat_id

**Table:** chat_interactions

**Columns:** chat_id

**SQL:**
```sql
CREATE INDEX idx_chat_interactions_chat_id ON chat_interactions(chat_id)
```

### idx_chat_interactions_created_at

**Table:** chat_interactions

**Columns:** created_at

**SQL:**
```sql
CREATE INDEX idx_chat_interactions_created_at ON chat_interactions(created_at)
```

### idx_chat_interactions_user_email

**Table:** chat_interactions

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_chat_interactions_user_email ON chat_interactions(user_email)
```

### idx_chat_interactions_user_id

**Table:** chat_interactions

**Columns:** user_id

**SQL:**
```sql
CREATE INDEX idx_chat_interactions_user_id ON chat_interactions(user_id)
```

### idx_item_id

**Table:** user_watchlist_items

**Columns:** item_id

**SQL:**
```sql
CREATE INDEX idx_item_id ON user_watchlist_items(item_id)
```

### idx_item_type

**Table:** user_watchlist_items

**Columns:** item_type

**SQL:**
```sql
CREATE INDEX idx_item_type ON user_watchlist_items(item_type)
```

### idx_notification_history_user

**Table:** notification_history

**Columns:** user_email, person_id, media_id, media_type

**SQL:**
```sql
CREATE INDEX idx_notification_history_user ON notification_history (user_email, person_id, media_id, media_type)
```

### idx_notifications_user_read

**Table:** notifications

**Columns:** user_email, read, created_at

**SQL:**
```sql
CREATE INDEX idx_notifications_user_read ON notifications(user_email, read, created_at DESC)
```

### idx_requests_email

**Table:** requests

**Columns:** email

**SQL:**
```sql
CREATE INDEX idx_requests_email ON requests(email)
```

### idx_requests_is_executed

**Table:** requests

**Columns:** is_executed

**SQL:**
```sql
CREATE INDEX idx_requests_is_executed ON requests(is_executed)
```

### idx_user_company_follows_email

**Table:** user_company_follows

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_user_company_follows_email 
ON user_company_follows(user_email)
```

### idx_user_custom_list_items_list_id

**Table:** user_custom_list_items

**Columns:** list_id

**SQL:**
```sql
CREATE INDEX idx_user_custom_list_items_list_id ON user_custom_list_items(list_id)
```

### idx_user_custom_lists_email

**Table:** user_custom_lists

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_user_custom_lists_email ON user_custom_lists(user_email)
```

### idx_user_custom_lists_slug

**Table:** user_custom_lists

**Columns:** slug

**SQL:**
```sql
CREATE INDEX idx_user_custom_lists_slug ON user_custom_lists(slug)
```

### idx_user_data_email

**Table:** user_data

**Columns:** email

**SQL:**
```sql
CREATE INDEX idx_user_data_email ON user_data(email)
```

### idx_user_email

**Table:** user_watchlist_items

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_user_email ON user_watchlist_items(user_email)
```

### idx_user_follows_email

**Table:** user_follows

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_user_follows_email ON user_follows (user_email)
```

### idx_user_item

**Table:** user_watchlist_items

**Columns:** user_email, item_id, item_type

**SQL:**
```sql
CREATE INDEX idx_user_item ON user_watchlist_items(user_email, item_id, item_type)
```

### idx_user_rating

**Table:** user_watchlist_items

**Columns:** user_rating

**SQL:**
```sql
CREATE INDEX idx_user_rating ON user_watchlist_items(user_rating)
```

### idx_user_tv_follows_email

**Table:** user_tv_follows

**Columns:** user_email

**SQL:**
```sql
CREATE INDEX idx_user_tv_follows_email ON user_tv_follows (user_email)
```

---

## Triggers

### extract_imdb_id_on_insert

**Table:** user_watchlist_items

**SQL:**
```sql
CREATE TRIGGER extract_imdb_id_on_insert
AFTER INSERT ON user_watchlist_items
FOR EACH ROW
WHEN NEW.external_ids IS NOT NULL
BEGIN
  UPDATE user_watchlist_items
  SET imdb_id = json_extract(NEW.external_ids, '$.imdb_id')
  WHERE id = NEW.id
    AND json_extract(NEW.external_ids, '$.imdb_id') IS NOT NULL;
END
```

### extract_imdb_id_on_update

**Table:** user_watchlist_items

**SQL:**
```sql
CREATE TRIGGER extract_imdb_id_on_update
AFTER UPDATE OF external_ids ON user_watchlist_items
FOR EACH ROW
WHEN NEW.external_ids IS NOT NULL
BEGIN
  UPDATE user_watchlist_items
  SET imdb_id = json_extract(NEW.external_ids, '$.imdb_id')
  WHERE id = NEW.id
    AND json_extract(NEW.external_ids, '$.imdb_id') IS NOT NULL;
END
```

### update_watchlist_timestamp

**Table:** user_watchlist_items

**SQL:**
```sql
CREATE TRIGGER update_watchlist_timestamp 
AFTER UPDATE ON user_watchlist_items
FOR EACH ROW
BEGIN
  UPDATE user_watchlist_items 
  SET updated_at = datetime('now') 
  WHERE id = NEW.id;
END
```

